<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>骨格診断</title>
<style>
body{font-family:sans-serif;text-align:center;padding:20px}
video,canvas{width:100%;max-width:400px;border-radius:12px}
button{margin:20px;padding:15px 30px;border-radius:999px;border:none;background:#000;color:#fff}
#loading{display:none;font-size:20px}
</style>
</head>
<body>

<h1>骨格診断</h1>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<button onclick="shoot()">撮影する</button>

<p id="loading">診断中です…</p>

<p style="font-size:12px;color:#555">
※上半身の骨格が判断できる状態で撮影してください<br>
※逆光にならないよう撮影してください
</p>

<script>
const video = document.getElementById("video");
navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
.then(s=>video.srcObject=s);

function shoot(){
  const c=document.getElementById("canvas");
  c.width=video.videoWidth;
  c.height=video.videoHeight;
  c.getContext("2d").drawImage(video,0,0);
  const img=c.toDataURL("image/jpeg",0.8);

  document.querySelector("button").style.display="none";
  document.getElementById("loading").style.display="block";

  // 受信側へ遷移（画像を渡す）
  location.href="viewer.html?img="+encodeURIComponent(img);
}
</script>

</body>
</html>
